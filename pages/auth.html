<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - Insight Room</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/auth.css') }}">
</head>
<body>
    <div class="animated-bg"></div>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="/" class="logo-link">Insight Room</a>
            </div>
            <nav class="nav">
                <a href="/" class="login-btn">На главную</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container auth-container">
            <div class="auth-card">
                <a href="/" class="back-home">← Назад</a>
                <h1 class="auth-title">Добро пожаловать!</h1>
                
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="showForm('login')">Вход</button>
                    <button class="auth-tab" onclick="showForm('register')">Регистрация</button>
                </div>

                <!-- Форма входа -->
                <form id="loginForm" class="auth-form active">
                    <div class="auth-method-selector">
                        <label class="form-label">Способ входа</label>
                        <select class="method-select" id="loginMethod">
                            <option value="login">Логин</option>
                            <option value="email">Email</option>
                            <option value="phone">Телефон</option>
                        </select>
                    </div>

                    <div class="method-input-group active" id="loginInput">
                        <label class="form-label">Логин</label>
                        <input type="text" class="form-input" placeholder="Ваш логин" id="loginField">
                    </div>

                    <div class="method-input-group" id="emailInput">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" placeholder="your@email.com" id="emailField">
                    </div>

                    <div class="method-input-group" id="phoneInput">
                        <label class="form-label">Телефон</label>
                        <input type="tel" class="form-input" placeholder="+7-000-000-00-00" id="phoneField">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" placeholder="Введите пароль" id="passwordField" required>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox"> Запомнить меня
                        </label>
                    </div>

                    <button type="submit" class="auth-btn">Войти</button>

                    <div class="auth-footer">
                        <a href="#" class="auth-link">Забыли пароль?</a>
                    </div>
                </form>

                <!-- Форма регистрации -->
                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Имя</label>
                        <input type="username" class="form-input" placeholder="Ваше имя" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Логин</label>
                        <input type="login" class="form-input" placeholder="Ваш логин" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" placeholder="your@email.com" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Телефон</label>
                        <input type="tel" class="form-input" placeholder="+7-000-000-00-00">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" placeholder="Не менее 8 символов" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Подтвердите пароль</label>
                        <input type="password" class="form-input" placeholder="Повторите пароль" required>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" required> 
                            Я согласен с <a href="#" class="auth-link">условиями использования</a>
                        </label>
                    </div>

                    <button type="submit" class="auth-btn" id="submitBtn">Создать аккаунт</button>
                </form>
            </div>
        </div>
    </main>

    
    <script src="{{ url_for('static', filename='JS/auth.js') }}"></script>
    <script>
        function showForm(formType) {
            // Обновляем активные табы
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Показываем активную форму
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(formType + 'Form').classList.add('active');
        }

        // Обработка форм
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Проверка, что заполнено хотя бы одно поле из трех
            const login = this.querySelector('input[type="text"]').value;
            const email = this.querySelector('input[type="email"]').value;
            const phone = this.querySelector('input[type="tel"]').value;
            const password = this.querySelector('input[type="password"]').value;
            
            if (!password) {
                alert('Пожалуйста, введите пароль');
                return;
            }
            
            if (!login && !email && !phone) {
                alert('Пожалуйста, заполните одно из полей: логин, email или телефон');
                return;
            }
            
            alert('Вход выполнен! В реальном приложении здесь была бы авторизация.');
        });

        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            // Проверка паролей
            const username = this.querySelectorAll('input[type="username"]')[0].value;
            const login = this.querySelectorAll('input[type="login"]')[0].value;
            const email = this.querySelectorAll('input[type="email"]')[0].value;
            const tel = this.querySelectorAll('input[type="tel"]')[0].value;
            const password = this.querySelectorAll('input[type="password"]')[0].value;
            const confirmPassword = this.querySelectorAll('input[type="password"]')[1].value;
            
            if (password !== confirmPassword) {
                alert('Пароли не совпадают!');
                return;
            }
            
            if (password.length < 8) {
                alert('Пароль должен содержать не менее 8 символов');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Регистрация...';
            //Регистрация
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        login: login,
                        email: email,
                        tel: tel,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                        console.log('Registration SUCCESS!')
                        window.location.replace('/')
                    }
                } catch (error) {
                    console.error('Ошибка:', error);
                } finally {
                    // Разблокируем кнопку
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Зарегистрироваться';
                }
        });
    </script>

    <!--<script>
        function showForm(formType) {
            // Обновляем активные табы
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Показываем активную форму
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(formType + 'Form').classList.add('active');
        }

        // функция для переключения полей входа
        function setupAuthMethodSelector() {
            const methodSelect = document.getElementById('loginMethod');
            const loginInput = document.getElementById('loginInput');
            const emailInput = document.getElementById('emailInput');
            const phoneInput = document.getElementById('phoneInput');
            
            methodSelect.addEventListener('change', function() {
                [loginInput, emailInput, phoneInput].forEach(input => {
                    input.classList.remove('active');
                });
                
                switch(this.value) {
                    case 'login':
                        loginInput.classList.add('active');
                        break;
                    case 'email':
                        emailInput.classList.add('active');
                        break;
                    case 'phone':
                        phoneInput.classList.add('active');
                        break;
                }
            });
        }

        // Обработка форм
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const method = document.getElementById('loginMethod').value;
            const password = document.getElementById('passwordField').value;
            let identifier = '';
            
            switch(method) {
                case 'login':
                    identifier = document.getElementById('loginField').value;
                    break;
                case 'email':
                    identifier = document.getElementById('emailField').value;
                    break;
                case 'phone':
                    identifier = document.getElementById('phoneField').value;
                    break;
            }
            
            if (!password) {
                alert('Пожалуйста, введите пароль');
                return;
            }
            
            if (!identifier) {
                alert('Пожалуйста, заполните поле для входа');
                return;
            }
            
            alert('Вход выполнен! В реальном приложении здесь была бы авторизация.');
        });

        // Обработка регистрации без изменений
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            // Проверка паролей
            const username = this.querySelector('input[type="text"]').value;
            const login = this.querySelectorAll('input[type="text"]')[1].value;
            const email = this.querySelector('input[type="email"]').value;
            const tel = this.querySelector('input[type="tel"]').value;
            const password = this.querySelectorAll('input[type="password"]')[0].value;
            const confirmPassword = this.querySelectorAll('input[type="password"]')[1].value;
            
            if (password !== confirmPassword) {
                alert('Пароли не совпадают!');
                return;
            }
            
            if (password.length < 8) {
                alert('Пароль должен содержать не менее 8 символов');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Регистрация...';
            
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        login: login,
                        email: email,
                        tel: tel,
                        password: password
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    console.log('Registration SUCCESS!')
                    window.location.replace('/')
                }
            } catch (error) {
                console.error('Ошибка:', error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Создать аккаунт';
            }
        });

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            setupAuthMethodSelector();
        });
    </script>-->
</body>
</html>