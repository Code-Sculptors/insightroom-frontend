<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Присоединиться - Insight Room</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
</head>
<body>
    <div class="animated-bg"></div>
    
    <header class="header">
        <div class="container">
            <div class="logo">
                <a href="/" class="logo-link">Insight Room</a>
            </div>
            <nav class="nav">
                <a href="/login" class="login-btn">Войти</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="content-card">
                <h1 class="content-title">Присоединиться к встрече</h1>
                <p class="content-subtitle">Введите код встречи или перейдите по ссылке</p>
                
                {% if error_message %}
                <div class="error-message" style="color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
                    {{ error_message }}
                </div>
                {% endif %}
                
                <form class="join-form" action="/join" method="POST">
                    <div class="form-group">
                        <label class="form-label">Код встречи</label>
                        <input type="text" name="meeting_code" class="form-input" placeholder="Введите код из приглашения" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ваше имя (необязательно)</label>
                        <input type="text" name="user_name" class="form-input" placeholder="Как вас представить участникам">
                        <small style="color: #666; font-size: 12px;">Если не указать, будет использовано "Участник"</small>
                    </div>
                    
                    <button type="submit" class="join-btn">Присоединиться</button>
                </form>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e9ecef;">
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        Или вставьте полную ссылку на встречу:
                    </p>
                    <form action="/join-by-link" method="POST">
                        <input type="text" name="meeting_link" class="form-input" placeholder="Вставьте ссылку на встречу" style="font-size: 14px;">
                        <button type="submit" class="join-btn" style="margin-top: 10px; width: 100%;">Присоединиться по ссылке</button>
                    </form>
                </div>
                
                <a href="/" class="home-btn">На главную</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Insight Room. Все права защищены.</p>
        </div>
    </footer>

    <script>
        // Восстановление имени пользователя из localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                document.querySelector('input[name="user_name"]').value = savedName;
            }
        });
        
        // Функция для логирования данных формы
        function logFormData(formData, formType) {
            console.log('=== ДАННЫЕ ФОРМЫ ПРИСОЕДИНЕНИЯ ===');
            console.log('Тип формы:', formType);
            console.log('Введенные параметры:');
            
            const meetingCode = formData.get('meeting_code') || formData.get('meeting_link');
            const userName = formData.get('user_name');
            
            console.log(`  meeting_code/link: ${meetingCode}`);
            console.log(`  user_name: ${userName ? userName : 'не указано'}`);
            //console.log(`  будет использовано: ${userName ? userName : 'Участник'}`);
            
            console.log('Временная метка:', new Date().toISOString());
            console.log('================================');
        }
        
        // Обработчик для формы присоединения по коду
        document.querySelector('.join-form').addEventListener('submit', function(e) {
            const formData = new FormData(this);
            
            // Логируем данные перед отправкой
            logFormData(formData, 'Присоединение по коду');
            
            // Сохраняем имя пользователя если указано
            const userName = this.querySelector('input[name="user_name"]').value;
            if (userName) {
                localStorage.setItem('userName', userName);
            }
        });
        
        // Обработчик для формы присоединения по ссылке
        document.querySelector('form[action="/join-by-link"]').addEventListener('submit', function(e) {
            const formData = new FormData(this);
            
            // Добавляем имя из основной формы если есть
            const mainFormName = document.querySelector('input[name="user_name"]').value;
            if (mainFormName) {
                formData.append('user_name', mainFormName);
            }
            
            // Логируем данные перед отправкой
            logFormData(formData, 'Присоединение по ссылке');
            
            // Сохраняем имя пользователя если указано
            if (mainFormName) {
                localStorage.setItem('userName', mainFormName);
            }
        });
    </script>
</body>
</html>